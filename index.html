<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Sheet Music Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea, button, pre {
            margin-top: 10px;
            width: 100%;
        }
        textarea {
            height: 150px;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>Piano Sheet Music Converter</h1>
    <p>Insert your virtual piano sheet music below:</p>
    <textarea id="input"></textarea>
    <button onclick="convert()">Convert</button>
    <h2>Output:</h2>
    <pre id="output"></pre>

    <script>
        function convert() {
            const input = document.getElementById('input').value.trim();
            const bpm = 120; // Example BPM, can be adjusted.
            const result = [];
            let i = 0;

            while (i < input.length) {
                const current = input[i];

                if (isNote(current)) {
                    // Handle the current note
                    result.push(`keypress("${current}", 0.15, bpm)`);

                    // Check the next character for rest logic
                    const next = input[i + 1];
                    if (isNote(next)) {
                        result.push(`rest(0.25, bpm)`); // Adjacent notes = 0.25 beat rest.
                    } else if (next === " ") {
                        result.push(`rest(0.5, bpm)`); // Space = 0.5 beat rest.
                        i++; // Skip space character.
                    } else if (next === "-") {
                        let dashCount = 0;
                        while (input[i + 1] === "-") {
                            dashCount++;
                            i++;
                        }
                        result.push(`rest(${dashCount}, bpm)`); // Dashes = beats.
                    } else if (next === "[") {
                        result.push(`rest(0.25, bpm)`); // Rest before brackets if adjacent.
                    }
                } else if (current === "[") {
                    // Handle notes in square brackets
                    let bracketContent = "";
                    i++; // Skip the opening bracket
                    while (i < input.length && input[i] !== "]") {
                        bracketContent += input[i];
                        i++;
                    }

                    // Split the content and add each keypress
                    const bracketNotes = bracketContent.split("");
                    bracketNotes.forEach(note => {
                        result.push(`keypress("${note}", 0.15, bpm)`);
                    });

                    // Check the next character for rest logic
                    const next = input[i + 1];
                    if (next === "]") {
                        result.push(`rest(0.25, bpm)`); // Rest between two square brackets.
                    } else if (next === " ") {
                        result.push(`rest(0.25, bpm)`); // Rest between two square brackets with space.
                        i++; // Skip space character.
                    } else if (next === "-") {
                        let dashCount = 0;
                        while (input[i + 1] === "-") {
                            dashCount++;
                            i++;
                        }
                        result.push(`rest(${dashCount}, bpm)`); // Dashes = beats.
                    } else if (next === "[") {
                        result.push(`rest(0.25, bpm)`); // Rest between consecutive square brackets.
                    }
                }

                i++;
            }

            document.getElementById('output').innerText = result.join('\n');
        }

        function isNote(char) {
            // Identify valid notes (letters, symbols for keys, etc.)
            return /[A-Za-z%!*]/.test(char);
        }
    </script>
</body>
</html>
